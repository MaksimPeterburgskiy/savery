{
  // See https://code.visualstudio.com/docs/editor/tasks for format docs
  "version": "2.0.0",
  "tasks": [
    {
      "label": "docker: start dragonfly",
      "type": "shell",
      "command": "bash",
      "args": [
        "-lc",
        "if docker ps -a --format '{{.Names}}' | grep -q '^savery-dragonfly$'; then docker start savery-dragonfly >/dev/null || true; else docker run -d --name savery-dragonfly -p 6379:6379 --ulimit memlock=-1 docker.dragonflydb.io/dragonflydb/dragonfly >/dev/null; fi"
      ],
      "problemMatcher": [],

      "presentation": {
        "group": "Docker"
      },
      "windows": {
        "command": "powershell",
        "args": [
          "-NoProfile",
          "-NonInteractive",
          "-Command",
          "if (docker ps -a --format '{{.Names}}' | Select-String -Quiet '^savery-dragonfly$') { docker start savery-dragonfly | Out-Null } else { docker run -d --name savery-dragonfly -p 6379:6379 --ulimit memlock=-1 docker.dragonflydb.io/dragonflydb/dragonfly | Out-Null }"
        ]
      }
    },
    {
      "label": "docker: start rabbitmq",
      "type": "shell",
      "command": "bash",
      "args": [
        "-lc",
        "if docker ps -a --format '{{.Names}}' | grep -q '^savery-rabbit$'; then docker start savery-rabbit >/dev/null || true; else docker run -d --name savery-rabbit -p 5672:5672 -p 15672:15672 rabbitmq:3-management >/dev/null; fi"
      ],
      "problemMatcher": [],
      "presentation": {
        "group": "Docker"
      },
      "windows": {
        "command": "powershell",
        "args": [
          "-NoProfile",
          "-NonInteractive",
          "-Command",
          "if (docker ps -a --format '{{.Names}}' | Select-String -Quiet '^savery-rabbit$') { docker start savery-rabbit | Out-Null } else { docker run -d --name savery-rabbit -p 5672:5672 -p 15672:15672 rabbitmq:3-management | Out-Null }"
        ]
      }
    },
    {
      "label": "docker: start messaging (rabbitmq+dragonfly)",
      "dependsOn": [
        "docker: start rabbitmq",
        "docker: start dragonfly"
      ],
      "problemMatcher": [],
      "presentation": {
        "group": "Docker"
      }
    },
    {
      "label": "docker: stop messaging (rabbitmq+dragonfly)",
      "type": "shell",
      "command": "bash",
      "args": [
        "-lc",
        "docker stop savery-rabbit savery-dragonfly >/dev/null 2>&1 || true"
      ],
      "problemMatcher": [],
      "presentation": {
        "group": "Docker"
      },
      "windows": {
        "command": "powershell",
        "args": [
          "-NoProfile",
          "-NonInteractive",
          "-Command",
          "docker stop savery-rabbit savery-dragonfly 2>$null | Out-Null; if ($LASTEXITCODE -ne 0) { $global:LASTEXITCODE = 0 }"
        ]
      }
    }
  ]
}
